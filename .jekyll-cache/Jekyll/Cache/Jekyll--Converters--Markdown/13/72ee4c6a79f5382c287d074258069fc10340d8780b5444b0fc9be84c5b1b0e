I"›E<h1 id="file-system">File System</h1>
<p>title: File System
subtitle: File System
categories: â€œOperating Systemâ€
tags: â€œOperating Systemâ€
date: 2021-01-19 19:11:14 +0000
last_modified_at: 2021-01-19 19:11:14 +0000
â€”</p>

<p>Created: Dec 17, 2020 1:44 PM
Reference: Jiman Hong: Soongsil Univ., Operating Systems Concepts 10th by A.Silberschatz P.Galvin and G.Gagne
status: completed</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">cleanUrl</span><span class="pi">:</span> <span class="s">/os/file-system</span>
<span class="na">disqus</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>ìˆ­ì‹¤ëŒ€í•™êµ ì»´í“¨í„°í•™ë¶€ í™ì§€ë§Œ êµìˆ˜ë‹˜ì˜ 2020-2í•™ê¸° ìš´ì˜ì²´ì œ ê°•ì˜ë¥¼ ì •ë¦¬ ë° ì¬êµ¬ì„±í–ˆë‹¤.</p>

<h2 id="block">Block</h2>

<p>OSëŠ” diskë¥¼ ì¼ì •í•œ í¬ê¸°ì˜ blockìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì €ì¥í•œë‹¤. ëŒ€ê°œ blockì˜ í¬ê¸°ëŠ” 4KBì´ë‹¤. ê° blockì€ ê·¸ ëª©ì ì— ë”°ë¼ ì•„ë˜ì˜ 4ê°€ì§€ë¡œ êµ¬ë¶„ì§€ì„ ìˆ˜ ìˆë‹¤.</p>

<ol>
  <li>
    <p>Super block</p>

    <p>file systemì˜ globalí•œ ì •ë³´ë“¤ì„ ë‹´ëŠ” blockìœ¼ë¡œ í•˜ë‚˜ì˜ file systemì— 1ê°œë§Œ ì¡´ì¬í•œë‹¤.</p>
  </li>
  <li>
    <p>Allocation structure block</p>

    <p>bitmap, linked list ë“±ì˜ ë°©ë²•ìœ¼ë¡œ inode structì™€ dataì— ëŒ€í•´ used/unused ì •ë³´ê°€ ì €ì¥ëœë‹¤.</p>
  </li>
  <li>
    <p>Key meta data block</p>

    <p>inode structì˜ tableì´ ì €ì¥ëœë‹¤.</p>
  </li>
  <li>
    <p>User data block</p>

    <p>ì‹¤ì œ dataë“¤ì´ ì €ì¥ëœë‹¤.</p>
  </li>
</ol>

<p>ì•„ë˜ëŠ” 2ê°œì˜ allocation structure blockì´ ê°ê° inode bitmap, data bitmapìœ¼ë¡œ ìš´ìš©ë˜ê³ , ìµœëŒ€ 80ê°œì˜ inode structê°€ 5ê°œì˜ key meta data blockì— ì €ì¥ë˜ëŠ” ê²½ìš°ì˜ ì „ì²´ disk êµ¬ì¡°ì´ë‹¤.</p>

<p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled.png" /></p>

<p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%201.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%201.png" /></p>

<h2 id="inode-struct">inode struct</h2>

<p>inode structì—ëŠ” fileì— ëŒ€í•œ meta dataê°€ ì €ì¥ëœë‹¤. ê° fileë§ˆë‹¤ í•˜ë‚˜ì˜ inode structê°€ ë¶€ì—¬ëœë‹¤. fileì˜ size, mode, permission, ì†Œìœ ì, ê°ì¢… ì‹œê° ë“±ì´ ì €ì¥ëœë‹¤. unixì˜ ls ëª…ë ¹ì–´ë¡œ ì¶œë ¥ë˜ëŠ” ì •ë³´ë“¤,  unistd.hì˜ stat() í•¨ìˆ˜ì—ì„œ ì–»ì„ ìˆ˜ ìˆëŠ” struct stat ì— ë‹´ê¸´ ì •ë³´ë“¤ì€ ëª¨ë‘ inode structì—ì„œ ê°€ì ¸ì˜¨ ê²ƒì´ë‹¤.</p>

<p>inode structì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ì •ë³´ëŠ” ì‹¤ì œ dataê°€ ì €ì¥ëœ user data blockì˜ pointerì´ë‹¤. fileì˜ í¬ê¸°ê°€ blockì˜ sizeë³´ë‹¤ í´ ê²½ìš°ì—ëŠ” ì—¬ëŸ¬ blockì„ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— data blockì„ ê°€ë¦¬í‚¤ëŠ” ì—¬ëŸ¬ pointer ë³€ìˆ˜ë“¤ì´ inode structì— ì¡´ì¬í•˜ê²Œ ëœë‹¤.</p>

<p>inode structì—ì„œ pointerë¡œ data blockì„ ê°€ë¦¬í‚¤ëŠ” ë°©ë²•ì—ëŠ” ì´ 2ê°€ì§€ê°€ ìˆëŠ”ë°, direct pointerë¡œ data blockì„ ì§ì ‘ ê°€ë¦¬í‚¤ëŠ” ë°©ë²•, indirect pointerë¡œ disk blockì„ ê°€ë¦¬í‚¤ëŠ” pointerë“¤ì´ ì €ì¥ëœ blockì„ ê°€ë¦¬í‚¤ëŠ” ë°©ë²•ì´ë‹¤. direct pointerë§Œì„ ì‚¬ìš©í•  ê²½ìš° í•œ fileì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ sizeì— ì œì•½ì´ ìƒê¸°ê²Œ ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ block sizeê°€ 4KBì´ê³ , inode structê°€ direct pointer 10ê°œë¥¼ ìš´ìš©í•œë‹¤ê³  í•  ê²½ìš°ì—ëŠ” í•œ fileì˜ ìµœëŒ€ sizeëŠ” 10<em>4KB=40KBê°€ ëœë‹¤. ë°˜ë©´ single indirect pointer 10ê°œë¥¼ ìš´ìš©í•œë‹¤ í•  ê²½ìš° ê° indirect pointerê°€ ìµœëŒ€ ì €ì¥í•  ìˆ˜ ìˆëŠ” pointerì˜ ê°œìˆ˜ëŠ” block size / sizeof(pointer)ì´ë¯€ë¡œ 4KB/4B = 1Kì´ë‹¤. ê° pointerëŠ” data blockì„ ê°€ë¦¬í‚¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ 10</em>1K*4KB = 40MBê°€ ëœë‹¤.</p>

<h2 id="directory">directory</h2>

<p>directoryëŠ” fileì˜ í•œ ì¢…ë¥˜ì´ë‹¤. ê·¸ë ‡ë‹¤ë©´ directoryì˜ inode structëŠ” ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ ìˆì„ê¹Œ? inode structì˜ ì¼ë°˜ì ì¸ êµ¬ì„±ê³¼ ë™ì¼í•˜ë‹¤. directoryì˜ data blockì—ì„œì˜ dataê°€ ë‹¤ë¥¸ë°, directory í•˜ìœ„ í•­ëª©ë“¤ì— ëŒ€í•œ linked listë¥¼ ì €ì¥ëœë‹¤. linked listì˜ ê° nodeëŠ” inode numberì™€ nameì„ êµ¬ì„± ìš”ì†Œë¡œ ê°–ëŠ”ë‹¤. ì´ ë•Œ inode struct pointerë¥¼ ì§ì ‘ ì €ì¥í•˜ì§€ ì•Šê³  ë‹¨ìˆœ index ë²ˆí˜¸ë§Œ ì €ì¥í•¨ìœ¼ë¡œì¨ ê³µê°„ì„ ì ˆì•½í•œë‹¤. directoryë§ˆë‹¤ ë‹¨ìˆœ ì„ í˜• linked listë¥¼ ìš´ìš©í•˜ê²Œ ë  ê²½ìš° ê¹Šì€ ê³„ì¸µ êµ¬ì¡°ë¥¼ ê°–ëŠ” directoryì—ì„œ ì„±ëŠ¥ì´ ë§ì´ í•˜ë½í•˜ê¸° ë•Œë¬¸ì— B-treeì™€ ê°™ì€ ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•´ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê¸°ë„ í•œë‹¤.</p>

<h2 id="file-descriptor--inode">file descriptor &amp; inode</h2>

<p>ê° processëŠ” ê³ ìœ í•œ file descriptor tableì„ ìš´ìš©í•œë‹¤. ê·¸ ì¤‘ 0ë²ˆì€ stdin, 1ë²ˆì€ stdout, 2ë²ˆì€ stderr fileë¡œ ë¯¸ë¦¬ ì˜ˆì•½ë˜ì–´ ìˆë‹¤. file descriptorë€ í•´ë‹¹ processê°€ ì–´ë–¤ fileì„ opení–ˆì„ ë•Œ returnë˜ëŠ” ê°’ì¸ë°, í•œ processê°€ í•œ fileì„ ì—¬ëŸ¬ ë²ˆ opení•  ìˆ˜ë„ ìˆë‹¤. ì´ ë•Œë§ˆë‹¤ file descriptorëŠ” ìƒˆë¡œ í• ë‹¹ë˜ê²Œ ëœë‹¤. ì¦‰, ê°™ì€ fileì— ëŒ€í•´ ë‹¤ë¥¸ file descriptorë¥¼ ë™ì‹œì— ê°€ì§ˆ ìˆ˜ë„ ìˆëŠ” ê²ƒì´ë‹¤. ê° file descriptorëŠ” open file tableì„ ê°€ë¦¬í‚¨ë‹¤. open file tableì˜ ê° í•­ëª©ì€ status(read/write ë“±), offset, inode sturct pointer ë“±ì„ ì €ì¥í•œë‹¤. open file tableì—ì„œ inode structë¥¼ ê°€ë¦¬í‚¤ê³ , inode structì˜ block pointerê°€ ì‹¤ì œë¡œ dataê°€ ì €ì¥ëœ data blockì„ ê°€ë¦¬í‚¤ëŠ” ê²ƒì´ë‹¤.</p>

<p>ì •ë¦¬í•˜ìë©´, file descriptor tableì€ processë§ˆë‹¤ ë³„ê°œë¡œ ë¶€ì—¬ë˜ëŠ” local êµ¬ì¡°ì´ê³ , open file table, inode tableì€ ì „ì²´ file systemì—ì„œ í•˜ë‚˜ë¥¼ ìš´ìš©í•˜ëŠ” global êµ¬ì¡°ì´ë‹¤. ê° í•­ëª©ì´ ê°€ë¦¬í‚¤ëŠ” ë°©í–¥ì€ file descriptor table â†’ open file table â†’ inode table â†’ data blockì´ë‹¤.</p>

<h2 id="reading-a-file-from-disk">Reading a File from Disk</h2>

<p>diskì—ì„œ ì‹¤ì œ fileì„ ì½ì–´ë“¤ì´ëŠ” ê³¼ì •ì„ ë”°ë¼ê°€ë³´ì. super blockë§Œì´ memoryì— ì˜¬ë¼ì™€ ìˆê³ , bitmapì´ ë‹´ê¸´ allocation structure blockì€ diskì— ë‚¨ì•„ìˆëŠ” ìƒíƒœë¼ê³  ê°€ì •í•´ë³´ì. ë‹¤ìŒì˜ ìˆœì„œë¥¼ ë”°ë¥¸ë‹¤.</p>

<p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%202.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%202.png" /></p>

<ol>
  <li>root directory (â€œ / â€œ) read
    <ol>
      <li>rootì˜ inode struct read</li>
      <li>rootì˜ block pointer íšë“</li>
      <li>rootì˜ data block read</li>
      <li>rootì˜ í•˜ìœ„ í•­ëª©ë“¤ì— ëŒ€í•œ linked list íšë“</li>
    </ol>
  </li>
  <li>foo directory (â€œ /foo â€œ) read
    <ol>
      <li>rootì˜ í•˜ìœ„ í•­ëª©ë“¤ì— ëŒ€í•œ linked listì—ì„œ ì´ë¦„ì´ â€œfooâ€ì¸ í•­ëª©ì˜ inode number íšë“</li>
      <li>inode numberë¥¼ í†µí•´ inode tableì—ì„œì˜ ì£¼ì†Œ ê³„ì‚°</li>
      <li>fooì˜ inode sturct read</li>
      <li>fooì˜ block pointer íšë“</li>
      <li>fooì˜ í•˜ìœ„ í•­ëª©ë“¤ì— ëŒ€í•œ linked list íšë“</li>
    </ol>
  </li>
  <li>bar file (â€œ /foo/bar â€œ) read
    <ol>
      <li>barì˜ í•˜ìœ„ í•­ëª©ë“¤ì— ëŒ€í•œ linked listì—ì„œ ì´ë¦„ì´ â€œbarâ€ì¸ í•­ëª©ì˜ inode number íšë“</li>
      <li>inode numberë¥¼ í†µí•´ inode tableì—ì„œì˜ ì£¼ì†Œ ê³„ì‚°</li>
      <li>barì˜ inode struct read</li>
    </ol>
  </li>
  <li>bar[0] read
    <ol>
      <li>barì˜ inode structì—ì„œ ì²«ë²ˆì§¸ data block pointer íšë“</li>
      <li>data block read</li>
      <li>bar inode struct write(access time ë“± ê°±ì‹  ìœ„í•¨)</li>
    </ol>
  </li>
  <li>bar[1] read
    <ol>
      <li>barì˜ inode structì—ì„œ ë‘ë²ˆì§¸ data block pointer íšë“</li>
      <li>data block read</li>
      <li>bar inode struct write(access time ë“± ê°±ì‹  ìœ„í•¨)</li>
    </ol>
  </li>
  <li>bar[2] read
    <ol>
      <li>barì˜ inode structì—ì„œ ì„¸ë²ˆì§¸ data block pointer íšë“</li>
      <li>data block read</li>
      <li>bar inode struct write(access time ë“± ê°±ì‹  ìœ„í•¨)</li>
    </ol>
  </li>
</ol>

<h2 id="creating--writing-a-file-from-disk">Creating &amp; Writing a File from Disk</h2>

<p>diskì—ì„œ ì‹¤ì œ fileì„ ìƒì„±í•˜ê³  writeí•˜ëŠ” ê³¼ì •ì„ ë”°ë¼ê°€ë³´ì. ì—­ì‹œë‚˜ super blockë§Œì´ memoryì— ì˜¬ë¼ì™€ ìˆê³ , bitmapì´ ë‹´ê¸´ allocation structure blockì€ diskì— ë‚¨ì•„ìˆëŠ” ìƒíƒœë¼ê³  ê°€ì •í•œë‹¤. ë‹¤ìŒì˜ ìˆœì„œë¥¼ ë”°ë¥¸ë‹¤.</p>

<p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%203.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%203.png" /></p>

<ol>
  <li>root directory (â€œ / â€œ) read
    <ol>
      <li>rootì˜ inode struct read</li>
      <li>rootì˜ block pointer íšë“</li>
      <li>rootì˜ data block read</li>
      <li>rootì˜ í•˜ìœ„ í•­ëª©ë“¤ì— ëŒ€í•œ linked list íšë“</li>
    </ol>
  </li>
  <li>foo directory (â€œ /foo â€œ) read
    <ol>
      <li>rootì˜ í•˜ìœ„ í•­ëª©ë“¤ì— ëŒ€í•œ linked listì—ì„œ ì´ë¦„ì´ â€œfooâ€ì¸ í•­ëª©ì˜ inode number íšë“</li>
      <li>inode numberë¥¼ í†µí•´ inode tableì—ì„œì˜ ì£¼ì†Œ ê³„ì‚°</li>
      <li>fooì˜ inode sturct read</li>
      <li>fooì˜ block pointer íšë“</li>
      <li>fooì˜ í•˜ìœ„ í•­ëª©ë“¤ì— ëŒ€í•œ linked list íšë“</li>
    </ol>
  </li>
  <li>bar file (â€œ /foo/bar â€œ) create
    <ol>
      <li>í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ inode numberì„ í™•ì¸í•˜ê¸° ìœ„í•´ inode bitmap read</li>
      <li>ë¯¸ì‚¬ìš© ì¤‘ì¸ inode number ì„ íƒ í›„ ì‚¬ìš© ì¤‘ìœ¼ë¡œ ë³€ê²½í•˜ê¸° ìœ„í•´ inode bitmap write</li>
      <li>fooì˜ í•˜ìœ„ í•­ëª©ë“¤ì— ëŒ€í•œ linked listì— íšë“í•œ inode numberì™€ â€œbarâ€ ëª…ì¹­ìœ¼ë¡œ í•­ëª© ì¶”ê°€í•˜ê¸° ìœ„í•´ bar data block write</li>
      <li>bar inode struct read (inode struct ì´ˆê¸°í™” ìœ„í•¨)</li>
      <li>bar inode struct write (inode struct ì´ˆê¸°í™” ìœ„í•¨)</li>
      <li>foo inode struct write (access time ë“± ê°±ì‹  ìœ„í•¨)</li>
    </ol>
  </li>
  <li>bar file (â€œ /foo/bar â€œ) write
    <ol>
      <li>write ê°€ëŠ¥í•œ ì—¬ìœ  ìˆëŠ” data block ì¡´ì¬ ì—¬ë¶€ í™•ì¸í•˜ê¸° ìœ„í•´ bar inode struct read</li>
      <li>í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ data block number í™•ì¸í•˜ê¸° ìœ„í•´ data bitmap read</li>
      <li>ë¯¸ì‚¬ìš© ì¤‘ì¸ data block number ì„ íƒ í›„ ì‚¬ìš© ì¤‘ìœ¼ë¡œ ë³€ê²½í•˜ê¸° ìœ„í•´ data bitmap write</li>
      <li>bar data block write</li>
      <li>bar inode write (access time ë“± ê°±ì‹  ìœ„í•¨)</li>
    </ol>
  </li>
</ol>

<h1 id="ffs-fast-file-system">FFS (Fast File System)</h1>

<p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%204.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%204.png" /></p>

<p>fast file systemì€ ê¸°ì¡´ì˜ unix file systemì—ì„œ ì„±ëŠ¥ì„ ë” í–¥ìƒì‹œí‚¨ file systemì´ë‹¤. ê¸°ì¡´ì˜ file systemì€ disk ì „ì²´ì— super block, inode bitmap, data bitmapì´ diskì— ì˜¤ì§ 1ê°œë§Œ ì¡´ì¬í–ˆë‹¤. ë˜í•œ inode ì—­ì‹œ diskì˜ í•œ ì˜ì—­ì— ëª°ë ¤ì„œ ì €ì¥ë˜ì–´ ìˆì–´ ì‹¤ì œ data blockë“¤ê³¼ì˜ diskìƒì—ì„œì˜ ë¬¼ë¦¬ì  ê±°ë¦¬ê°€ ë©€ ìˆ˜ ë°–ì— ì—†ì—ˆë‹¤. FFSëŠ” ì´ëŸ¬í•œ ë‹¨ì ì„ í•´ê²°í•˜ê³ ì disk ì „ì²´ë¥¼ ì—¬ëŸ¬ groupìœ¼ë¡œ ë‚˜ëˆ„ê³ , ê° groupë§ˆë‹¤ super block, bitmaps, inodes, data blockë“¤ì„ ë¶€ì—¬í•œë‹¤. ì´ë¥¼ í†µí•´ inodeì—ì„œ ì°¸ì¡°í•˜ëŠ” data blockê³¼ ì‹¤ì œ inodeê°€ ì €ì¥ëœ block ì‚¬ì´ì˜ ë¬¼ë¦¬ì  ê±°ë¦¬ê°€ ì¤„ì–´ë“¤ì–´ seek timeì´ ê°ì†Œí•œë‹¤.</p>

<p>ë˜í•œ FFSëŠ” directory êµ¬ì¡° ì—­ì‹œ ê°œì„ í–ˆëŠ”ë°, ê¸°ì¡´ì˜ file systemì€ ë‹¨ìˆœí•œ ê³„ì¸µ êµ¬ì¡°ì˜€ê¸°ì— í•˜ìœ„ fileë“¤ì˜ data blockì´ ë¶€ëª¨ directoryì˜ data blockê³¼ ë©€ë¦¬ ë–¨ì–´ì ¸ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†í›„í–ˆë‹¤. FFSëŠ” ë™ì¼í•œ directoryì— ìˆëŠ” fileì— ì ‘ê·¼í•  í™•ë¥ ì´ 40%ë‚˜ ëœë‹¤ëŠ” í†µê³„ì— ê¸°ë°˜í•´ (Name-based Locality) directoryì™€ ê·¸ í•˜ìœ„ fileë“¤ì„ disk ë‚´ì—ì„œ ê°™ì€ group ì•ˆì— ë°°ì¹˜í•˜ë„ë¡ í–ˆë‹¤. ì´ë¥¼ í†µí•´ seek timeì„ ê°ì†Œì‹œí‚¬ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%205.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%205.png" /></p>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ, FFSëŠ” disk layoutì— ëŒ€í•´ì„œ ìµœì í™”ë¥¼ ìˆ˜í–‰í–ˆë‹¤. ì´ˆê¸° hard diskëŠ” HWì˜ ì„±ëŠ¥ì´ ë–¨ì–´ì ¸ rotation ì†ë„ê°€ ë§ì´ ëŠë ¸ë‹¤. í•˜ì§€ë§Œ ì ì°¨ HWê°€ ë°œì „í•¨ì— ë”°ë¼ rotation ì†ë„ê°€ ë¹„ì•½ì ìœ¼ë¡œ ìƒìŠ¹í–ˆê³ , ì—°ì†ëœ sectorë¥¼ ì½ì–´ë“¤ì´ê¸°ì—ëŠ” ì´ë¯¸ headê°€ ë‹¤ìŒ sectorë¥¼ ì§€ë‚˜ì³ë²„ë¦¬ëŠ” ì¦ìƒì´ ë°œìƒí•˜ê²Œ ë˜ì—ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ FFSëŠ” ë‹¤ìŒ sectorë¥¼ ì—°ì†ì ìœ¼ë¡œ ë°°ì¹˜í•˜ì§€ ì•Šê³ , 1ì¹¸ ë’¤ì— ë°°ì¹˜í•˜ëŠ” ì‹ìœ¼ë¡œ sector ë°°ì¹˜ë¥¼ ë³€ê²½í–ˆë‹¤.</p>

<p>ì´ ì™¸ì—ë„ FFSëŠ” blockì˜ í¬ê¸°ë¥¼ ì¤„ì—¬ ë‚´ë¶€ ë‹¨í¸í™” í˜„ìƒì„ ê°ì†Œì‹œí‚¤ê³ , symbolic linkë¥¼ ë„ì…í•˜ëŠ” ë“±ì˜ ì—¬ëŸ¬ ë³€í™”ë¥¼ ì±„íƒí–ˆë‹¤.</p>

<h1 id="crash-consistency">Crash Consistency</h1>

<h2 id="disk-crash-scenario">Disk Crash Scenario</h2>

<p>disk I/O ê³¼ì •ì—ì„œ crashê°€ ë°œìƒí•˜ëŠ” ê²½ìš°ì— ëŒ€í•´ì„œ ì‚´í´ë³´ì. ì´ë¯¸ ì¡´ì¬í•˜ëŠ” fileì— ëŒ€í•´ ìƒˆë¡œìš´ dataë¥¼ appendí•˜ëŠ” ê²½ìš°ì—ëŠ” data bitmap, inodes, data blockì„ ê°±ì‹ í•´ì•¼ í•œë‹¤. ìœ„ì˜ 3ê°€ì§€ blockë“¤ì— ëŒ€í•œ ê°±ì‹ ì€ atomicí•˜ê²Œ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤. ì´ ê³¼ì •ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” crash scenarioëŠ” ë‹¤ìŒì˜ 6ê°€ì§€ì´ë‹¤.</p>

<ol>
  <li>
    <p>data blockë§Œ ì •ìƒ ê°±ì‹ , data bitmap, inodesëŠ” crashë˜ëŠ” ê²½ìš°</p>

    <p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%206.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%206.png" /></p>

    <p>data bitmapê³¼ inodesê°€ ëª¨ë‘ crashë˜ì—ˆê¸° ë•Œë¬¸ì— bitmapê³¼ inodes ì‚¬ì´ì˜ ë¶ˆì¼ì¹˜(inconsistent)ëŠ” ì—†ë‹¤. ë”°ë¼ì„œ consistentí•œ ìƒí™©ì´ë‹¤. ëŒ€ì‹  data blockì€ ê°±ì‹ ì´ ë˜ì—ˆëŠ”ë°, í•´ë‹¹ blockì€ data bitmapì—ì„œë„ unusedë¡œ í‘œì‹œê°€ ë˜ì–´ ìˆê³ , inodesì—ë„ data block í¬ì¸í„°ê°€ ì—°ê²°ì´ ë˜ì–´ ìˆì§€ ì•Šê¸° ë–„ë¬¸ì— garbage dataì´ë‹¤.</p>
  </li>
  <li>
    <p>inodesë§Œ ì •ìƒ ê°±ì‹ , data bitmap, data blockì€ crashë˜ëŠ” ê²½ìš°</p>

    <p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%207.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%207.png" /></p>

    <p>data bitmapì€ crash, inodesëŠ” ì •ìƒ ê°±ì‹ ë˜ì—ˆê¸° ë•Œë¬¸ì— inconsistentí•œ ìƒí™©ì´ë‹¤. inodesëŠ” ì´ë¯¸ data blockì„ ê°€ë¦¬í‚¤ëŠ”ë° í•´ë‹¹ data blockì—ëŠ” dataê°€ ì“°ì—¬ ìˆì§€ ì•Šê³ , data bitmapì—ì„œë„ í•´ë‹¹ data blockì€ unusedë¡œ í‘œì‹œê°€ ë˜ì–´ ìˆë‹¤.</p>
  </li>
  <li>
    <p>data bitmapë§Œ ì •ìƒ ê°±ì‹ , inodes, data blockì€ crashë˜ëŠ” ê²½ìš°</p>

    <p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%208.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%208.png" /></p>

    <p>data bitmapì€ ì •ìƒ ê°±ì‹ ë˜ì—ˆì§€ë§Œ, inodesëŠ” crashë˜ì—ˆê¸° ë•Œë¬¸ì— inconsistentí•œ ìƒí™©ì´ë‹¤. data blockì—ëŠ” writeê°€ ë˜ì§€ ì•Šì•˜ê³ , inodesì—ì„œë„ í•´ë‹¹ data blockì„ ê°€ë¦¬í‚¤ì§€ ì•ŠëŠ”ë° datat bitmapì—ì„œëŠ” usedë¡œ í‘œì‹œê°€ ë˜ì–´ìˆëŠ” ê²½ìš°ì´ë‹¤. ì´í›„ í•´ë‹¹ data blockì€ ì‚¬ìš©ë˜ì§€ ëª»í•˜ê³  ë‚­ë¹„ë  ê²ƒì´ë‹¤.</p>
  </li>
  <li>
    <p>data bitmap, inodesëŠ” ì •ìƒ ê°±ì‹ , data blockë§Œ crashë˜ëŠ” ê²½ìš°</p>

    <p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%209.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%209.png" /></p>

    <p>data bitmapê³¼ inodesê°€ ëª¨ë‘ ì •ìƒê°±ì‹  ë˜ì—ˆê¸° ë•Œë¬¸ì— consistentí•œ ìƒí™©ì´ë‹¤. data blockì— writeë§Œ ë˜ì§€ ì•Šì€ ê²ƒì´ê¸° ë•Œë¬¸ì— garbage dataê°€ ì €ì¥ëœ ìƒíƒœì´ë‹¤.</p>
  </li>
  <li>
    <p>inodes, data blockì€ ì •ìƒ ê°±ì‹ , data bitmapë§Œ crashë˜ëŠ” ê²½ìš°</p>

    <p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%2010.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%2010.png" /></p>

    <p>data bitmapì€ crashë˜ê³ , inodesëŠ” ì •ìƒ ê°±ì‹ ë˜ì—ˆê¸° ë•Œë¬¸ì— inconsistentí•œ ìƒí™©ì´ë‹¤. ì´ ê²½ìš° inodeì—ì„œ data blockì„ ê°€ë¦¬í‚¤ê³ , í•´ë‹¹ data blockì—ëŠ” ì •ìƒì ì¸ dataê°€ ì“°ì—¬ì ¸ ìˆìŒì—ë„ data bitmapì—ì„œ unusedë¡œ í‘œì‹œê°€ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì–¸ì œë“  ë®ì–´ì”Œì›Œì§ˆ ìˆ˜ ìˆê³ , ë‹¤ë¥¸ inodeê°€ ë™ì¼í•œ data blockì„ ê°€ë¦¬í‚¬ ìˆ˜ë„ ìˆë‹¤.</p>
  </li>
  <li>
    <p>data bitmap, data blockì€ ì •ìƒ ê°±ì‹ , inodesë§Œ crashë˜ëŠ” ê²½ìš°</p>

    <p><img src="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%2011.png" alt="File%20System%20bdaddc6bb70742ce98401ff67400c6eb/Untitled%2011.png" /></p>

    <p>data bitmapì€ ì •ìƒ ê°±ì‹ , inodesëŠ” crashë˜ì—ˆê¸° ë•Œë¬¸ì— inconsistentí•œ ìƒí™©ì´ë‹¤. ì´ ê²½ìš° data blockì—ë„ ì •ìƒì ì¸ dataê°€ ì“°ì—¬ì ¸ ìˆê³  data bitmapì—ì„œë„ usedë¡œ í‘œì‹œê°€ ë˜ì—ˆì§€ë§Œ inodesì—ì„œ í•´ë‹¹ data blockì„ ê°€ë¦¬í‚¤ì§€ ì•Šê¸° ë•Œë¬¸ì— í•´ë‹¹ data blockì€ ì–´ë–¤ fileì—ë„ ì—°ê²°ë˜ì§€ ëª»í•œë‹¤. ì´ë¥¼ orphan data blockì´ë¼ê³  í•œë‹¤.</p>
  </li>
</ol>

<h2 id="fsck">FSCK</h2>

<p>FSCKëŠ” unixì—ì„œ file systemì—ì„œì˜ crash inconsistencyë¥¼ ì°¾ì•„ë‚´ í•´ê²°í•˜ëŠ” ë„êµ¬ì´ë‹¤. ì´ˆê¸°ì˜ file systemì€ crash inconsistencyë¥¼ ë°œê²¬í•˜ë”ë¼ë„ ë¬´ì‹œí–ˆë‹¤ê°€ rebooting ê³¼ì •ì—ì„œ ì´ë¥¼ í•´ê²°í–ˆë‹¤. FSCKëŠ” rebooting ì—†ì´ë„ ì´ë¥¼ í•´ê²°í•˜ê³ ì ê°œë°œë˜ì—ˆë‹¤. FSCK ë™ì‘ ì¤‘ì—ëŠ” file systemì´ ì–´ë– í•œ ë‹¤ë¥¸ ë™ì‘ë„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  ê°€ì •í•œë‹¤.</p>

<p>FSCKëŠ” inodes ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ bitmapì„ ì¬ê°±ì‹ í•œë‹¤. ê°œë…ì ìœ¼ë¡œ ê°„ë‹¨í•˜ê³  ë³„ë„ì˜ write overheadê°€ ì—†ë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ, ê³¼ë„í•˜ê²Œ ë§ì€ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ê³ , consistentí•œ ê²½ìš°ì— ëŒ€í•´ì„œëŠ” í•´ê²°ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤.</p>

<h2 id="journaling-wal-write-ahead-logging">Journaling (WAL: Write-Ahead Logging)</h2>

<p>Journalingì€ disk I/O, íŠ¹íˆ write ì—°ì‚° ì‹œì— logë¥¼ ê¸°ë¡í•´ ì €ì¥í–ˆë‹¤ê°€ ì´ë¥¼ crash inconsistencyë¥¼ í•´ê²°í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ë‹¤. write ìš”ì²­ì´ ì˜¬ ê²½ìš° diskëŠ” ì´ë¥¼ ì¦‰ì‹œ ê°±ì‹ í•˜ì§€ ì•Šê³  write ì‘ì—… ì¤‘ ìˆ˜í–‰í•  ì—°ì‚°ë“¤ì— ëŒ€í•œ  logë¥¼ ë¯¸ë¦¬ ì‘ì„±í•œë‹¤. ì´í›„ ë§Œì•½ write ë„ì¤‘ disk crashê°€ ë°œìƒí•  ê²½ìš°, í•´ë‹¹ logë¥¼ í™•ì¸í•´ ë‹¤ì‹œ writeë¥¼ ìˆ˜í–‰í•œë‹¤. ì´ëŸ¬í•œ logë¥¼ ì €ì¥í•˜ëŠ” ìš©ë„ë¡œ diskì— journal blockì„ ìƒˆë¡œ ì¶”ê°€í•œë‹¤. logì˜ ì €ì¥ ë‹¨ìœ„ëŠ” transactionì´ë‹¤.</p>
:ET